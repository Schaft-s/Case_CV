# Кейс по компьютерному зрению - отбор на смену в Сириус.
Условие [здесь](task.md).

### Анализ поставленной задачи.
Здесь описаны основные ступени решения кейса, а также мои идеи решения каждой из них.

#### 1. **Удаление фона**
   - **Анализ задачи**: Изучение различных алгоритмов сегментации, таких как:
     - Классические подходы: Пороговые модели, цветовая сегментация, K-means clustering.
     - Современные подходы: Fully Convolutional Networks (FCN), DeepLab, UNet.
   - **Выбор и реализация подхода**: 
     - Обоснование выбора UNet.
     - Разметка данных.
     - Обучение UNet на размеченном датасете (item vs. background).
   - **Метрики для оценки удаления фона**:
     - Intersection over Union (IoU) для оценки точности сегментации.
     - Визуальная проверка результатов на тестовых изображениях.

#### 2. **Замена фона**
   - **Анализ задачи**: Казалось бы не стоит запариваться и можно лепить подготовленную текстуру. Хотя можно было бы придумать методы генерации интересного фона на основе цветов изображения, или подходящих по смыслу. (сгененрировать сначала описание, на основе него анализировать на каком фоне должен быть объект)
   - **Реализация**:
     - После сегментации, замена фона на одноцветную текстуру (10 пастельных цветов).
     - Добавление функции выбора фона из предложенного набора (из загруженных текстур).
     - Добавление возможности генерации фона с градиентом цветов. _захотелось, нравится)_ 
     - _Обеспечение естественного наложения фона без резких границ. (пока не узнал как сделать, но явно нужно и наверное можно)_

#### 3. **Генерация описания товара**
  - уже чуть дальше от задачки на CV, но какие-то базовые идеи попробую реализовать. пока не успел
  - Из метрик знаю такие.. 
     - BLEU или ROUGE для оценки качества текста (сравнение с эталонными описаниями).
     - Вручную созданный набор правил для оценки точности информации.

_На мой взгляд самая интересная часть кейса - это именно решение задачи напрямую связанной с CV (первый пункт). Поэтому бо'льшая часть времени была потрачена на эту часть, поэтому бо'льшее внимание будет уделено ей._
**Решение кейса:**

# 1. Анализ и обоснования выбора способа решения для задачи сегментации фона

### 1.1.1 **Методы для сегментации изображений**:
1. **Пороговые методы**:
   - Способы сегментации на основе анализа яркости пикселей.
   - Не подходят из-за частой схожести цветов объекта и фона
2. **Сегментация на основе цветовых моделей**:
   - Использование цветовых моделей для разделения объекта и фона.
   - Не подходит по той же причине.
3. **Кластеризация (Clustering)**:
   - Например, алгоритм **K-means** могут быть использованы для сегментации на основе пиксельных кластеров.
   - Вроде работает лучше, чем простые пороговые методы.
   - Проблемы - требует настройки параметров, сложно добиться точных результатов без предварительной обработки изображений.
4. **Графовые методы (Graph-based segmentation)**: честно говоря не до конца разобрался.. просто знаю что существуют
5. **Алгоритмы на основе глубокого обучения**:
   - Например, **Fully Convolutional Networks (FCN)**, **SegNet**, **DeepLab**, и **UNet**. 
   - **Плюсы**: способны обрабатывать сложные сцены, хорошо справляются с артефактами на границах, высокое качество сегментации.
   - **Минусы**: требуют большого объема данных для обучения, относительно сложная модель. Также требуют размеченных данных (((((((
   - Так как нейронки часто показывают лучший результат и сейчас являются state-of-the-art то остановился на них.

### 1.1.2. **Обоснование выбора UNet**:
- **UNet** была выбрана как baseline модель, которая в итоге показала отличные результаты, на ней и остановился. Это архитектура, специально разработанная для сегментации изображений и широко применяется в медицине и других областях, требующих высокой точности.
![image](https://github.com/user-attachments/assets/da4b51db-6077-4310-86e4-0d2cbd71a9c3)

- **Преимущества UNet**:
  - **Симметричная архитектура с пропуском связей**: слои кодирования передают информацию напрямую в соответствующие слои декодирования, что позволяет более точно восстанавливать детали границ объекта.
  - **Устойчивость к малым объемам данных**: UNet демонстрирует хорошие результаты даже при ограниченном наборе данных, особенно если использовать аугментации данных.
  - **Высокая точность**: глубокие слои позволяют извлекать сложные паттерны, а система пропусков связи минимизирует потери информации, что особенно важно для сегментации мелких деталей.
  - **Гибкость**: модель легко модифицируется и может быть адаптирована к специфике задачи (например, к сегментации товаров с различными формами и текстурами).

# 1.2. Реализация сегментации фона. Часть 1. Разметка....
### Подготовка датасета
  - Первоначально надо собрать данные.
    - По заданию был выдан архив, поэтому взял фото из него.
    - Половина мне жутко не понравились, но как бы задание есть задание.
  - Далее нужно разделить их на train, validation, test.
    - В связи с тем что данных немного - test=validation.
    - Отобрал 50 почти случайных картинок и отложил их в отдельную папку - test. 
    - _(итоговый используемый датасет с разметкой достаточно объёмный и не хочет загружаться на гитхаб, скину по требованию, если что-почта firsov.sa@phystech.su)_
### Разметка в CVAT
  - Для обучения нейросетей нам нужны данный с правильными ответами, то есть в нашем случае - с разметкой.
  - Для получения разметки был выбран инструмент CVAT.
  - Если в рассказе пропустить несколько дней потраченных на разметку, то вот результат:
    - После обработки получились 355 фото на тесте и 50 на валидации. _(чуть перетасовал добавив больше сложных примеров тест, а ещё часть потерял...)_
    - Разметка происходила на два класса - item и backgroung
    - Все изображения представлены парой .jpg и .png с одинаковыми названиями, первое - изначальное изображение, второе - маска.
    - Вроде это называется формат CamVid 1.0
      ![image](https://github.com/user-attachments/assets/ee59daaf-0458-4938-89f8-2a450e043439)

# 1.3. Реализация сегментации фона. Часть 2. Предобработка, обучение и результаты
  - Далее предстоит долгий разговор про обучение модели. Файл [тут](main_file_segmentation.ipynb), иногда даже комментарии есть.
  - 
![image](https://github.com/user-attachments/assets/0aaeb4d2-8db8-45ab-838c-cc72dced3832)
![image](https://github.com/user-attachments/assets/45af2ff0-f305-4e0f-97fc-f3fffbd20ed7)
![image](https://github.com/user-attachments/assets/c30fe922-96c7-4cb1-9b78-1d032baa29c0)

# 2. Замена фона




Используемая литература
  - Сегментация на UNET [статья](https://habr.com/ru/articles/746842/)
  - Курс по CV на практике. Видеозаписи помогающие разобраться с запуском базовых моделей. [тут](https://youtube.com/playlist?list=PLou0mfoS85QWscWhcdf7Zl00poc0q7s8c&si=LIPAzgiN7pfLGhC7)
  - Туториал по настройке UNET [тут](https://youtu.be/zpyzBR3MuT0?si=HsGnA2_TD_eUAXhF)
  - [CVAT](https://www.cvat.ai/)
  - [Туториал](https://habr.com/ru/articles/677484/) по разметке в CVAT.
  - 
